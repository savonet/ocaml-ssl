<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Ssl (ssl.Ssl)</title><link rel="stylesheet" href="../../odoc.support/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.2.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../index.html">ssl</a> &#x00BB; Ssl</nav><header class="odoc-preamble"><h1>Module <code><span>Ssl</span></code></h1><p>Functions for making encrypted communications using the Secure Socket Layer (SSL). These are mostly bindings to the openssl library.</p><ul class="at-tags"><li class="author"><span class="at-tag">author</span> Samuel Mimram</li></ul></header><nav class="odoc-toc"><ul><li><a href="#exceptions-and-errors">Exceptions and errors</a></li><li><a href="#communication">Communication</a><ul><li><a href="#threads">Threads</a></li><li><a href="#contexts">Contexts</a></li><li><a href="#ciphers">Ciphers</a></li><li><a href="#certificates">Certificates</a></li><li><a href="#creating,-connecting,-closing-and-configuring-sockets">Creating, connecting, closing and configuring sockets</a></li><li><a href="#i/o-on-ssl-sockets">I/O on SSL sockets</a><ul><li><a href="#high-level-communication-functions">High-level communication functions</a></li></ul></li></ul></li></ul></nav><div class="odoc-content"><h2 id="exceptions-and-errors"><a href="#exceptions-and-errors" class="anchor"></a>Exceptions and errors</h2><div class="odoc-spec"><div class="spec type anchored" id="type-ssl_error"><a href="#type-ssl_error" class="anchor"></a><code><span><span class="keyword">type</span> ssl_error</span><span> = </span></code><ol><li id="type-ssl_error.Error_none" class="def variant constructor anchored"><a href="#type-ssl_error.Error_none" class="anchor"></a><code><span>| </span><span><span class="constructor">Error_none</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>No error happened. This is never raised and should disappear in future versions.</p><span class="comment-delim">*)</span></div></li><li id="type-ssl_error.Error_ssl" class="def variant constructor anchored"><a href="#type-ssl_error.Error_ssl" class="anchor"></a><code><span>| </span><span><span class="constructor">Error_ssl</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>A non-recoverable, fatal error in the SSL library occurred, usually a protocol error. The OpenSSL error queue contains more information on the error. If this error occurs then no further I/O operations should be performed on the connection and SSL_shutdown() must not be called.</p><span class="comment-delim">*)</span></div></li><li id="type-ssl_error.Error_want_read" class="def variant constructor anchored"><a href="#type-ssl_error.Error_want_read" class="anchor"></a><code><span>| </span><span><span class="constructor">Error_want_read</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The operation did not complete; the same TLS/SSL I/O function should be called again later.</p><span class="comment-delim">*)</span></div></li><li id="type-ssl_error.Error_want_write" class="def variant constructor anchored"><a href="#type-ssl_error.Error_want_write" class="anchor"></a><code><span>| </span><span><span class="constructor">Error_want_write</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The operation did not complete; the same TLS/SSL I/O function should be called again later.</p><span class="comment-delim">*)</span></div></li><li id="type-ssl_error.Error_want_x509_lookup" class="def variant constructor anchored"><a href="#type-ssl_error.Error_want_x509_lookup" class="anchor"></a><code><span>| </span><span><span class="constructor">Error_want_x509_lookup</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The operation did not complete because an application callback set by <code>set_client_cert_cb</code> has asked to be called again. The TLS/SSL I/O function should be called again later. Details depend on the application.</p><span class="comment-delim">*)</span></div></li><li id="type-ssl_error.Error_syscall" class="def variant constructor anchored"><a href="#type-ssl_error.Error_syscall" class="anchor"></a><code><span>| </span><span><span class="constructor">Error_syscall</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Some I/O error occurred. The OpenSSL error queue may contain more information on the error.</p><span class="comment-delim">*)</span></div></li><li id="type-ssl_error.Error_zero_return" class="def variant constructor anchored"><a href="#type-ssl_error.Error_zero_return" class="anchor"></a><code><span>| </span><span><span class="constructor">Error_zero_return</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The TLS/SSL connection has been closed. If the protocol version is SSL 3.0 or TLS 1.0, this result code is returned only if a closure alert has occurred in the protocol, i.e. if the connection has been closed cleanly. Note that in this case <code>Error_zero_return</code> does not necessarily indicate that the underlying transport has been closed.</p><span class="comment-delim">*)</span></div></li><li id="type-ssl_error.Error_want_connect" class="def variant constructor anchored"><a href="#type-ssl_error.Error_want_connect" class="anchor"></a><code><span>| </span><span><span class="constructor">Error_want_connect</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The operation did not complete; the same TLS/SSL I/O function should be called again later.</p><span class="comment-delim">*)</span></div></li><li id="type-ssl_error.Error_want_accept" class="def variant constructor anchored"><a href="#type-ssl_error.Error_want_accept" class="anchor"></a><code><span>| </span><span><span class="constructor">Error_want_accept</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The operation did not complete; the same TLS/SSL I/O function should be called again later.</p><span class="comment-delim">*)</span></div></li><li id="type-ssl_error.Error_want_async" class="def variant constructor anchored"><a href="#type-ssl_error.Error_want_async" class="anchor"></a><code><span>| </span><span><span class="constructor">Error_want_async</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The operation did not complete because an asynchronous engine is still processing data. The TLS/SSL I/O function should be called again later. The function must be called from the same thread that the original call was made from.</p><span class="comment-delim">*)</span></div></li><li id="type-ssl_error.Error_want_async_job" class="def variant constructor anchored"><a href="#type-ssl_error.Error_want_async_job" class="anchor"></a><code><span>| </span><span><span class="constructor">Error_want_async_job</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The asynchronous job could not be started because there were no async jobs available in the pool. The application should retry the operation after a currently executing asynchronous operation for the current thread has completed.</p><span class="comment-delim">*)</span></div></li><li id="type-ssl_error.Error_want_client_hello_cb" class="def variant constructor anchored"><a href="#type-ssl_error.Error_want_client_hello_cb" class="anchor"></a><code><span>| </span><span><span class="constructor">Error_want_client_hello_cb</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The operation did not complete because an application callback set by SSL_CTX_set_client_hello_cb() has asked to be called again. The TLS/SSL I/O function should be called again later. Details depend on the application.</p><span class="comment-delim">*)</span></div></li><li id="type-ssl_error.Error_want_retry_verify" class="def variant constructor anchored"><a href="#type-ssl_error.Error_want_retry_verify" class="anchor"></a><code><span>| </span><span><span class="constructor">Error_want_retry_verify</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>See https://www.openssl.org/docs/manmaster/man3/SSL_CTX_set_verify.html</p><span class="comment-delim">*)</span></div></li></ol></div><div class="spec-doc"><p>An ssl error has occurred (see SSL_get_error(3ssl) for details).</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-bigarray"><a href="#type-bigarray" class="anchor"></a><code><span><span class="keyword">type</span> bigarray</span><span> =
  <span><span>(char, <span class="xref-unresolved">Stdlib</span>.Bigarray.int8_unsigned_elt, <span class="xref-unresolved">Stdlib</span>.Bigarray.c_layout)</span>
    <span class="xref-unresolved">Stdlib</span>.Bigarray.Array1.t</span></span></code></div></div><div class="odoc-spec"><div class="spec exception anchored" id="exception-Method_error"><a href="#exception-Method_error" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">Method_error</span></span></code></div><div class="spec-doc"><p>The SSL method could not be initialized.</p></div></div><div class="odoc-spec"><div class="spec exception anchored" id="exception-Context_error"><a href="#exception-Context_error" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">Context_error</span></span></code></div></div><div class="odoc-spec"><div class="spec exception anchored" id="exception-Cipher_error"><a href="#exception-Cipher_error" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">Cipher_error</span></span></code></div></div><div class="odoc-spec"><div class="spec exception anchored" id="exception-Diffie_hellman_error"><a href="#exception-Diffie_hellman_error" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">Diffie_hellman_error</span></span></code></div></div><div class="odoc-spec"><div class="spec exception anchored" id="exception-Ec_curve_error"><a href="#exception-Ec_curve_error" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">Ec_curve_error</span></span></code></div></div><div class="odoc-spec"><div class="spec exception anchored" id="exception-Certificate_error"><a href="#exception-Certificate_error" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">Certificate_error</span> <span class="keyword">of</span> string</span></code></div><div class="spec-doc"><p>The SSL server certificate could not be initialized.</p></div></div><div class="odoc-spec"><div class="spec exception anchored" id="exception-Private_key_error"><a href="#exception-Private_key_error" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">Private_key_error</span> <span class="keyword">of</span> string</span></code></div><div class="spec-doc"><p>The SSL server private key could not be initialized.</p></div></div><div class="odoc-spec"><div class="spec exception anchored" id="exception-Unmatching_keys"><a href="#exception-Unmatching_keys" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">Unmatching_keys</span></span></code></div><div class="spec-doc"><p>The SSL private key does not match the certificate public key.</p></div></div><div class="odoc-spec"><div class="spec exception anchored" id="exception-Invalid_socket"><a href="#exception-Invalid_socket" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">Invalid_socket</span></span></code></div><div class="spec-doc"><p>The given socket is invalid.</p></div></div><div class="odoc-spec"><div class="spec exception anchored" id="exception-Handler_error"><a href="#exception-Handler_error" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">Handler_error</span></span></code></div><div class="spec-doc"><p>The SSL handler could not be initialized.</p></div></div><div class="odoc-spec"><div class="spec exception anchored" id="exception-Connection_error"><a href="#exception-Connection_error" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">Connection_error</span> <span class="keyword">of</span> <a href="#type-ssl_error">ssl_error</a></span></code></div><div class="spec-doc"><p>The connection could not be made with the SSL service.</p></div></div><div class="odoc-spec"><div class="spec exception anchored" id="exception-Accept_error"><a href="#exception-Accept_error" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">Accept_error</span> <span class="keyword">of</span> <a href="#type-ssl_error">ssl_error</a></span></code></div><div class="spec-doc"><p>Failed to accept an SSL connection.</p></div></div><div class="odoc-spec"><div class="spec exception anchored" id="exception-Read_error"><a href="#exception-Read_error" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">Read_error</span> <span class="keyword">of</span> <a href="#type-ssl_error">ssl_error</a></span></code></div><div class="spec-doc"><p>An error occurred while reading data.</p></div></div><div class="odoc-spec"><div class="spec exception anchored" id="exception-Write_error"><a href="#exception-Write_error" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">Write_error</span> <span class="keyword">of</span> <a href="#type-ssl_error">ssl_error</a></span></code></div><div class="spec-doc"><p>An error occurred while writing data.</p></div></div><div class="odoc-spec"><div class="spec exception anchored" id="exception-Flush_error"><a href="#exception-Flush_error" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">Flush_error</span> <span class="keyword">of</span> bool</span></code></div><div class="spec-doc"><p>An error occurred while flushing a socket. <code>Flush_error true</code> means that the operation should be retried.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-verify_error"><a href="#type-verify_error" class="anchor"></a><code><span><span class="keyword">type</span> verify_error</span><span> = </span></code><ol><li id="type-verify_error.Error_v_unable_to_get_issuer_cert" class="def variant constructor anchored"><a href="#type-verify_error.Error_v_unable_to_get_issuer_cert" class="anchor"></a><code><span>| </span><span><span class="constructor">Error_v_unable_to_get_issuer_cert</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The issuer certificate could not be found: this occurs if the issuer certificate of an untrusted certificate cannot be found.</p><span class="comment-delim">*)</span></div></li><li id="type-verify_error.Error_v_unable_to_get_ctl" class="def variant constructor anchored"><a href="#type-verify_error.Error_v_unable_to_get_ctl" class="anchor"></a><code><span>| </span><span><span class="constructor">Error_v_unable_to_get_ctl</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The CRL of a certificate could not be found.</p><span class="comment-delim">*)</span></div></li><li id="type-verify_error.Error_v_unable_to_decrypt_cert_signature" class="def variant constructor anchored"><a href="#type-verify_error.Error_v_unable_to_decrypt_cert_signature" class="anchor"></a><code><span>| </span><span><span class="constructor">Error_v_unable_to_decrypt_cert_signature</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The certificate signature could not be decrypted. This means that the actual signature value could not be determined rather than it not matching the expected value, this is only meaningful for RSA keys.</p><span class="comment-delim">*)</span></div></li><li id="type-verify_error.Error_v_unable_to_decrypt_CRL_signature" class="def variant constructor anchored"><a href="#type-verify_error.Error_v_unable_to_decrypt_CRL_signature" class="anchor"></a><code><span>| </span><span><span class="constructor">Error_v_unable_to_decrypt_CRL_signature</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The CRL signature could not be decrypted: this means that the actual signature value could not be determined rather than it not matching the expected value. Unused.</p><span class="comment-delim">*)</span></div></li><li id="type-verify_error.Error_v_unable_to_decode_issuer_public_key" class="def variant constructor anchored"><a href="#type-verify_error.Error_v_unable_to_decode_issuer_public_key" class="anchor"></a><code><span>| </span><span><span class="constructor">Error_v_unable_to_decode_issuer_public_key</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The public key in the certificate SubjectPublicKeyInfo could not be read.</p><span class="comment-delim">*)</span></div></li><li id="type-verify_error.Error_v_cert_signature_failure" class="def variant constructor anchored"><a href="#type-verify_error.Error_v_cert_signature_failure" class="anchor"></a><code><span>| </span><span><span class="constructor">Error_v_cert_signature_failure</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The signature of the certificate is invalid.</p><span class="comment-delim">*)</span></div></li><li id="type-verify_error.Error_v_CRL_signature_failure" class="def variant constructor anchored"><a href="#type-verify_error.Error_v_CRL_signature_failure" class="anchor"></a><code><span>| </span><span><span class="constructor">Error_v_CRL_signature_failure</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The signature of the certificate is invalid.</p><span class="comment-delim">*)</span></div></li><li id="type-verify_error.Error_v_cert_not_yet_valid" class="def variant constructor anchored"><a href="#type-verify_error.Error_v_cert_not_yet_valid" class="anchor"></a><code><span>| </span><span><span class="constructor">Error_v_cert_not_yet_valid</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The certificate is not yet valid: the notBefore date is after the current time.</p><span class="comment-delim">*)</span></div></li><li id="type-verify_error.Error_v_cert_has_expired" class="def variant constructor anchored"><a href="#type-verify_error.Error_v_cert_has_expired" class="anchor"></a><code><span>| </span><span><span class="constructor">Error_v_cert_has_expired</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The certificate has expired: that is the notAfter date is before the current time.</p><span class="comment-delim">*)</span></div></li><li id="type-verify_error.Error_v_CRL_not_yet_valid" class="def variant constructor anchored"><a href="#type-verify_error.Error_v_CRL_not_yet_valid" class="anchor"></a><code><span>| </span><span><span class="constructor">Error_v_CRL_not_yet_valid</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The CRL is not yet valid.</p><span class="comment-delim">*)</span></div></li><li id="type-verify_error.Error_v_CRL_has_expired" class="def variant constructor anchored"><a href="#type-verify_error.Error_v_CRL_has_expired" class="anchor"></a><code><span>| </span><span><span class="constructor">Error_v_CRL_has_expired</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The CRL has expired.</p><span class="comment-delim">*)</span></div></li><li id="type-verify_error.Error_v_error_in_cert_not_before_field" class="def variant constructor anchored"><a href="#type-verify_error.Error_v_error_in_cert_not_before_field" class="anchor"></a><code><span>| </span><span><span class="constructor">Error_v_error_in_cert_not_before_field</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The certificate notBefore field contains an invalid time.</p><span class="comment-delim">*)</span></div></li><li id="type-verify_error.Error_v_error_in_cert_not_after_field" class="def variant constructor anchored"><a href="#type-verify_error.Error_v_error_in_cert_not_after_field" class="anchor"></a><code><span>| </span><span><span class="constructor">Error_v_error_in_cert_not_after_field</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The certificate notAfter field contains an invalid time.</p><span class="comment-delim">*)</span></div></li><li id="type-verify_error.Error_v_error_in_CRL_last_update_field" class="def variant constructor anchored"><a href="#type-verify_error.Error_v_error_in_CRL_last_update_field" class="anchor"></a><code><span>| </span><span><span class="constructor">Error_v_error_in_CRL_last_update_field</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The CRL lastUpdate field contains an invalid time.</p><span class="comment-delim">*)</span></div></li><li id="type-verify_error.Error_v_error_in_CRL_next_update_field" class="def variant constructor anchored"><a href="#type-verify_error.Error_v_error_in_CRL_next_update_field" class="anchor"></a><code><span>| </span><span><span class="constructor">Error_v_error_in_CRL_next_update_field</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The CRL nextUpdate field contains an invalid time.</p><span class="comment-delim">*)</span></div></li><li id="type-verify_error.Error_v_out_of_mem" class="def variant constructor anchored"><a href="#type-verify_error.Error_v_out_of_mem" class="anchor"></a><code><span>| </span><span><span class="constructor">Error_v_out_of_mem</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>An error occurred trying to allocate memory. This should never happen.</p><span class="comment-delim">*)</span></div></li><li id="type-verify_error.Error_v_depth_zero_self_signed_cert" class="def variant constructor anchored"><a href="#type-verify_error.Error_v_depth_zero_self_signed_cert" class="anchor"></a><code><span>| </span><span><span class="constructor">Error_v_depth_zero_self_signed_cert</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The passed certificate is self signed and the same certificate cannot be found in the list of trusted certificates.</p><span class="comment-delim">*)</span></div></li><li id="type-verify_error.Error_v_self_signed_cert_in_chain" class="def variant constructor anchored"><a href="#type-verify_error.Error_v_self_signed_cert_in_chain" class="anchor"></a><code><span>| </span><span><span class="constructor">Error_v_self_signed_cert_in_chain</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The certificate chain could be built up using the untrusted certificates but the root could not be found locally.</p><span class="comment-delim">*)</span></div></li><li id="type-verify_error.Error_v_unable_to_get_issuer_cert_locally" class="def variant constructor anchored"><a href="#type-verify_error.Error_v_unable_to_get_issuer_cert_locally" class="anchor"></a><code><span>| </span><span><span class="constructor">Error_v_unable_to_get_issuer_cert_locally</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The issuer certificate of a locally looked up certificate could not be found. This normally means the list of trusted certificates is not complete.</p><span class="comment-delim">*)</span></div></li><li id="type-verify_error.Error_v_unable_to_verify_leaf_signature" class="def variant constructor anchored"><a href="#type-verify_error.Error_v_unable_to_verify_leaf_signature" class="anchor"></a><code><span>| </span><span><span class="constructor">Error_v_unable_to_verify_leaf_signature</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>No signatures could be verified because the chain contains only one certificate and it is not self signed.</p><span class="comment-delim">*)</span></div></li><li id="type-verify_error.Error_v_cert_chain_too_long" class="def variant constructor anchored"><a href="#type-verify_error.Error_v_cert_chain_too_long" class="anchor"></a><code><span>| </span><span><span class="constructor">Error_v_cert_chain_too_long</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The certificate chain length is greater than the supplied maximum depth. Unused.</p><span class="comment-delim">*)</span></div></li><li id="type-verify_error.Error_v_cert_revoked" class="def variant constructor anchored"><a href="#type-verify_error.Error_v_cert_revoked" class="anchor"></a><code><span>| </span><span><span class="constructor">Error_v_cert_revoked</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The certificate has been revoked.</p><span class="comment-delim">*)</span></div></li><li id="type-verify_error.Error_v_invalid_CA" class="def variant constructor anchored"><a href="#type-verify_error.Error_v_invalid_CA" class="anchor"></a><code><span>| </span><span><span class="constructor">Error_v_invalid_CA</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>A CA certificate is invalid. Either it is not a CA or its extensions are not consistent with the supplied purpose.</p><span class="comment-delim">*)</span></div></li><li id="type-verify_error.Error_v_path_length_exceeded" class="def variant constructor anchored"><a href="#type-verify_error.Error_v_path_length_exceeded" class="anchor"></a><code><span>| </span><span><span class="constructor">Error_v_path_length_exceeded</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The basicConstraints pathlength parameter has been exceeded.</p><span class="comment-delim">*)</span></div></li><li id="type-verify_error.Error_v_invalid_purpose" class="def variant constructor anchored"><a href="#type-verify_error.Error_v_invalid_purpose" class="anchor"></a><code><span>| </span><span><span class="constructor">Error_v_invalid_purpose</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The supplied certificate cannot be used for the specified purpose.</p><span class="comment-delim">*)</span></div></li><li id="type-verify_error.Error_v_cert_untrusted" class="def variant constructor anchored"><a href="#type-verify_error.Error_v_cert_untrusted" class="anchor"></a><code><span>| </span><span><span class="constructor">Error_v_cert_untrusted</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The root CA is not marked as trusted for the specified purpose.</p><span class="comment-delim">*)</span></div></li><li id="type-verify_error.Error_v_cert_rejected" class="def variant constructor anchored"><a href="#type-verify_error.Error_v_cert_rejected" class="anchor"></a><code><span>| </span><span><span class="constructor">Error_v_cert_rejected</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The root CA is marked to reject the specified purpose.</p><span class="comment-delim">*)</span></div></li><li id="type-verify_error.Error_v_subject_issuer_mismatch" class="def variant constructor anchored"><a href="#type-verify_error.Error_v_subject_issuer_mismatch" class="anchor"></a><code><span>| </span><span><span class="constructor">Error_v_subject_issuer_mismatch</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The current candidate issuer certificate was rejected because its subject name did not match the issuer name of the current certificate.</p><span class="comment-delim">*)</span></div></li><li id="type-verify_error.Error_v_akid_skid_mismatch" class="def variant constructor anchored"><a href="#type-verify_error.Error_v_akid_skid_mismatch" class="anchor"></a><code><span>| </span><span><span class="constructor">Error_v_akid_skid_mismatch</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The current candidate issuer certificate was rejected because its subject key identifier was present and did not match the authority key identifier current certificate.</p><span class="comment-delim">*)</span></div></li><li id="type-verify_error.Error_v_akid_issuer_serial_mismatch" class="def variant constructor anchored"><a href="#type-verify_error.Error_v_akid_issuer_serial_mismatch" class="anchor"></a><code><span>| </span><span><span class="constructor">Error_v_akid_issuer_serial_mismatch</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The current candidate issuer certificate was rejected because its issuer name and serial number was present and did not match the authority key identifier of the current certificate.</p><span class="comment-delim">*)</span></div></li><li id="type-verify_error.Error_v_keyusage_no_certsign" class="def variant constructor anchored"><a href="#type-verify_error.Error_v_keyusage_no_certsign" class="anchor"></a><code><span>| </span><span><span class="constructor">Error_v_keyusage_no_certsign</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The current candidate issuer certificate was rejected because its keyUsage extension does not permit certificate signing.</p><span class="comment-delim">*)</span></div></li><li id="type-verify_error.Error_v_application_verification" class="def variant constructor anchored"><a href="#type-verify_error.Error_v_application_verification" class="anchor"></a><code><span>| </span><span><span class="constructor">Error_v_application_verification</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>An application specific error. Unused.</p><span class="comment-delim">*)</span></div></li></ol></div><div class="spec-doc"><p>Why did the certificate verification fail?</p></div></div><div class="odoc-spec"><div class="spec exception anchored" id="exception-Verify_error"><a href="#exception-Verify_error" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">Verify_error</span> <span class="keyword">of</span> <a href="#type-verify_error">verify_error</a></span></code></div><div class="spec-doc"><p>An error occurred while verifying the certificate.</p></div></div><h2 id="communication"><a href="#communication" class="anchor"></a>Communication</h2><div class="odoc-spec"><div class="spec value anchored" id="val-init"><a href="#val-init" class="anchor"></a><code><span><span class="keyword">val</span> init : <span>?thread_safe:bool <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Initialize SSL functions. Should be called before calling any other function. The parameter <code>thread_safe</code> should be set to true if you use threads in you application (the same effect can achieved by calling <code>Ssl_threads.init</code> first.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_error_string"><a href="#val-get_error_string" class="anchor"></a><code><span><span class="keyword">val</span> get_error_string : <span>unit <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Retrieve a human-readable message that corresponds to the earliest error code from the thread's error queue and removes the entry.</p><ul class="at-tags"><li class="deprecated"><span class="at-tag">deprecated</span> Use [Ssl.Error.get_error] instead</li></ul></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Error"><a href="#module-Error" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Error/index.html">Error</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-protocol"><a href="#type-protocol" class="anchor"></a><code><span><span class="keyword">type</span> protocol</span><span> = </span></code><ol><li id="type-protocol.SSLv23" class="def variant constructor anchored"><a href="#type-protocol.SSLv23" class="anchor"></a><code><span>| </span><span><span class="constructor">SSLv23</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>accept all possible protocols (SSLv2 if supported by openssl, SSLv3, TLSv1, TLSv1.1, TLSv1.2, and TLSv1.3)</p><ul class="at-tags"><li class="deprecated"><span class="at-tag">deprecated</span> SSL 2.0 was deprecated in 2011 by RFC 6176.</li></ul><span class="comment-delim">*)</span></div></li><li id="type-protocol.SSLv3" class="def variant constructor anchored"><a href="#type-protocol.SSLv3" class="anchor"></a><code><span>| </span><span><span class="constructor">SSLv3</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>only SSL v3 protocol</p><ul class="at-tags"><li class="deprecated"><span class="at-tag">deprecated</span> SSL 3.0 was deprecated in June 2015 by RFC 7568.</li></ul><span class="comment-delim">*)</span></div></li><li id="type-protocol.TLSv1" class="def variant constructor anchored"><a href="#type-protocol.TLSv1" class="anchor"></a><code><span>| </span><span><span class="constructor">TLSv1</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>only TLS v1 protocol</p><ul class="at-tags"><li class="deprecated"><span class="at-tag">deprecated</span> TLS 1.0 and 1.1 were formally deprecated in RFC8996 in March 2021.</li></ul><span class="comment-delim">*)</span></div></li><li id="type-protocol.TLSv1_1" class="def variant constructor anchored"><a href="#type-protocol.TLSv1_1" class="anchor"></a><code><span>| </span><span><span class="constructor">TLSv1_1</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>only TLS v1.1 protocol</p><ul class="at-tags"><li class="deprecated"><span class="at-tag">deprecated</span> TLS 1.0 and 1.1 were formally deprecated in RFC8996 in March 2021.</li></ul><span class="comment-delim">*)</span></div></li><li id="type-protocol.TLSv1_2" class="def variant constructor anchored"><a href="#type-protocol.TLSv1_2" class="anchor"></a><code><span>| </span><span><span class="constructor">TLSv1_2</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>only TLS v1.2 protocol</p><span class="comment-delim">*)</span></div></li><li id="type-protocol.TLSv1_3" class="def variant constructor anchored"><a href="#type-protocol.TLSv1_3" class="anchor"></a><code><span>| </span><span><span class="constructor">TLSv1_3</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>only TLS v1.3 protocol</p><span class="comment-delim">*)</span></div></li></ol></div><div class="spec-doc"><p>Protocol used by SSL.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-socket"><a href="#type-socket" class="anchor"></a><code><span><span class="keyword">type</span> socket</span></code></div><div class="spec-doc"><p>An SSL abstract socket.</p></div></div><h3 id="threads"><a href="#threads" class="anchor"></a>Threads</h3><p>You should not have to use those functions. They are only here for internal use (they are needed to make the openssl library thread-safe, see the <code>Ssl_threads</code> module).</p><div class="odoc-spec"><div class="spec value anchored" id="val-thread_safe"><a href="#val-thread_safe" class="anchor"></a><code><span><span class="keyword">val</span> thread_safe : <span>bool <span class="xref-unresolved">Stdlib</span>.ref</span></span></code></div></div><h3 id="contexts"><a href="#contexts" class="anchor"></a>Contexts</h3><div class="odoc-spec"><div class="spec type anchored" id="type-context"><a href="#type-context" class="anchor"></a><code><span><span class="keyword">type</span> context</span></code></div><div class="spec-doc"><p>A context. A context should be created by a server or client once per program life-time and holds mainly default values for the SSL structures which are later created for the connections.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-context_type"><a href="#type-context_type" class="anchor"></a><code><span><span class="keyword">type</span> context_type</span><span> = </span></code><ol><li id="type-context_type.Client_context" class="def variant constructor anchored"><a href="#type-context_type.Client_context" class="anchor"></a><code><span>| </span><span><span class="constructor">Client_context</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Client connections.</p><span class="comment-delim">*)</span></div></li><li id="type-context_type.Server_context" class="def variant constructor anchored"><a href="#type-context_type.Server_context" class="anchor"></a><code><span>| </span><span><span class="constructor">Server_context</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Server connections.</p><span class="comment-delim">*)</span></div></li><li id="type-context_type.Both_context" class="def variant constructor anchored"><a href="#type-context_type.Both_context" class="anchor"></a><code><span>| </span><span><span class="constructor">Both_context</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Client and server connections.</p><span class="comment-delim">*)</span></div></li></ol></div><div class="spec-doc"><p>Type of the context to create.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-create_context"><a href="#val-create_context" class="anchor"></a><code><span><span class="keyword">val</span> create_context : <span><a href="#type-protocol">protocol</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-context_type">context_type</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-context">context</a></span></code></div><div class="spec-doc"><p>Create a context.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-add_extra_chain_cert"><a href="#val-add_extra_chain_cert" class="anchor"></a><code><span><span class="keyword">val</span> add_extra_chain_cert : <span><a href="#type-context">context</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Add an additional certificate to the extra chain certificates associated with the <code>ctx</code>. Extra chain certificates will be sent to the peer for verification and are sent in order following the end entity certificate. The value should be contents of the certificate as string in PEM format.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-add_cert_to_store"><a href="#val-add_cert_to_store" class="anchor"></a><code><span><span class="keyword">val</span> add_cert_to_store : <span><a href="#type-context">context</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Add a certificate to the <code>ctx</code> trust storage. The value should be contents of the certificate as string in PEM format.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-use_certificate"><a href="#val-use_certificate" class="anchor"></a><code><span><span class="keyword">val</span> use_certificate : <span><a href="#type-context">context</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>use_certificate ctx cert privkey</code> makes the context <code>ctx</code> use <code>cert</code> as * certificate's file name (in PEM format) and <code>privkey</code> as private key file * name.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-use_certificate_from_string"><a href="#val-use_certificate_from_string" class="anchor"></a><code><span><span class="keyword">val</span> use_certificate_from_string : <span><a href="#type-context">context</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Use a certificate whose contents is given as argument (you should use instead <code>use_certificate</code> if you want to read the certificate from a file).</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-set_password_callback"><a href="#val-set_password_callback" class="anchor"></a><code><span><span class="keyword">val</span> set_password_callback : <span><a href="#type-context">context</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span>bool <span class="arrow">&#45;&gt;</span></span> string)</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Set the callback function called to get passwords for encrypted PEM files. * The callback function takes a boolean argument which indicates if it's used * for reading/decryption (<code>false</code>) or writing/encryption (<code>true</code>).</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-set_client_CA_list_from_file"><a href="#val-set_client_CA_list_from_file" class="anchor"></a><code><span><span class="keyword">val</span> set_client_CA_list_from_file : <span><a href="#type-context">context</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Set the list of CAs sent to the client when requesting a client certificate.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-verify_mode"><a href="#type-verify_mode" class="anchor"></a><code><span><span class="keyword">type</span> verify_mode</span><span> = </span></code><ol><li id="type-verify_mode.Verify_peer" class="def variant constructor anchored"><a href="#type-verify_mode.Verify_peer" class="anchor"></a><code><span>| </span><span><span class="constructor">Verify_peer</span></span></code></li><li id="type-verify_mode.Verify_fail_if_no_peer_cert" class="def variant constructor anchored"><a href="#type-verify_mode.Verify_fail_if_no_peer_cert" class="anchor"></a><code><span>| </span><span><span class="constructor">Verify_fail_if_no_peer_cert</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Implies <code>Verify_peer</code>.</p><span class="comment-delim">*)</span></div></li><li id="type-verify_mode.Verify_client_once" class="def variant constructor anchored"><a href="#type-verify_mode.Verify_client_once" class="anchor"></a><code><span>| </span><span><span class="constructor">Verify_client_once</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Implies <code>Verify_peer</code>.</p><span class="comment-delim">*)</span></div></li></ol></div><div class="spec-doc"><p>Verification modes (see SSL_CTX_set_verify(3)).</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-verify_callback"><a href="#type-verify_callback" class="anchor"></a><code><span><span class="keyword">type</span> verify_callback</span></code></div><div class="spec-doc"><p>A callback function for verification. Warning: this might change in the future.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-client_verify_callback"><a href="#val-client_verify_callback" class="anchor"></a><code><span><span class="keyword">val</span> client_verify_callback : <a href="#type-verify_callback">verify_callback</a></span></code></div><div class="spec-doc"><p>Client's verification callback. Warning: this might change in the future.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-set_client_verify_callback_verbose"><a href="#val-set_client_verify_callback_verbose" class="anchor"></a><code><span><span class="keyword">val</span> set_client_verify_callback_verbose : <span>bool <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Set verbosity of <a href="#val-client_verify_callback"><code>client_verify_callback</code></a></p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-set_verify"><a href="#val-set_verify" class="anchor"></a><code><span><span class="keyword">val</span> set_verify : <span><a href="#type-context">context</a> <span class="arrow">&#45;&gt;</span></span> <span><span><a href="#type-verify_mode">verify_mode</a> list</span> <span class="arrow">&#45;&gt;</span></span> <span><span><a href="#type-verify_callback">verify_callback</a> option</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Set the verify mode and callback, see SSL_CTX_set_verify(3). * Warning: this might change in the future.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-set_verify_depth"><a href="#val-set_verify_depth" class="anchor"></a><code><span><span class="keyword">val</span> set_verify_depth : <span><a href="#type-context">context</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Set the maximum depth for the certificate chain verification that shall be allowed.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-set_context_alpn_protos"><a href="#val-set_context_alpn_protos" class="anchor"></a><code><span><span class="keyword">val</span> set_context_alpn_protos : <span><a href="#type-context">context</a> <span class="arrow">&#45;&gt;</span></span> <span><span>string list</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Set the list of supported ALPN protocols for negotiation to the context.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-set_context_alpn_select_callback"><a href="#val-set_context_alpn_select_callback" class="anchor"></a><code><span><span class="keyword">val</span> set_context_alpn_select_callback : 
  <span><a href="#type-context">context</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><span>string list</span> <span class="arrow">&#45;&gt;</span></span> <span>string option</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p>Set the callback to allow server to select the preferred protocol from client's available protocols.</p></div></div><h3 id="ciphers"><a href="#ciphers" class="anchor"></a>Ciphers</h3><div class="odoc-spec"><div class="spec type anchored" id="type-cipher"><a href="#type-cipher" class="anchor"></a><code><span><span class="keyword">type</span> cipher</span></code></div><div class="spec-doc"><p>A cipher. It holds the algorithm information for a particular cipher which * are a core part of the SSL/TLS protocol.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-disable_protocols"><a href="#val-disable_protocols" class="anchor"></a><code><span><span class="keyword">val</span> disable_protocols : <span><a href="#type-context">context</a> <span class="arrow">&#45;&gt;</span></span> <span><span><a href="#type-protocol">protocol</a> list</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Disable all protocols from the list. * Note that <code>SSLv23</code> disables both SSLv2 and SSLv3 (as opposed to all the * protocols). *</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-set_cipher_list"><a href="#val-set_cipher_list" class="anchor"></a><code><span><span class="keyword">val</span> set_cipher_list : <span><a href="#type-context">context</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Set the list of available ciphers for a context. See man ciphers(1) for the format of the string.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-honor_cipher_order"><a href="#val-honor_cipher_order" class="anchor"></a><code><span><span class="keyword">val</span> honor_cipher_order : <span><a href="#type-context">context</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>When choosing a cipher, use the server's preferences instead of the client * preferences. When not set, the SSL server will always follow the clients * preferences. When set, the SSLv3/TLSv1 server will choose following its * own preferences. Because of the different protocol, for SSLv2 the server * will send its list of preferences to the client and the client chooses.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-init_dh_from_file"><a href="#val-init_dh_from_file" class="anchor"></a><code><span><span class="keyword">val</span> init_dh_from_file : <span><a href="#type-context">context</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Init DH parameters from file</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-init_ec_from_named_curve"><a href="#val-init_ec_from_named_curve" class="anchor"></a><code><span><span class="keyword">val</span> init_ec_from_named_curve : <span><a href="#type-context">context</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Init EC curve from curve name</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_cipher"><a href="#val-get_cipher" class="anchor"></a><code><span><span class="keyword">val</span> get_cipher : <span><a href="#type-socket">socket</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-cipher">cipher</a></span></code></div><div class="spec-doc"><p>Get the cipher used by a socket.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_cipher_description"><a href="#val-get_cipher_description" class="anchor"></a><code><span><span class="keyword">val</span> get_cipher_description : <span><a href="#type-cipher">cipher</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Get a description of a cipher.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_cipher_name"><a href="#val-get_cipher_name" class="anchor"></a><code><span><span class="keyword">val</span> get_cipher_name : <span><a href="#type-cipher">cipher</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Get the name of a cipher.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_cipher_version"><a href="#val-get_cipher_version" class="anchor"></a><code><span><span class="keyword">val</span> get_cipher_version : <span><a href="#type-cipher">cipher</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Get the version of a cipher.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-version"><a href="#val-version" class="anchor"></a><code><span><span class="keyword">val</span> version : <span><a href="#type-socket">socket</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-protocol">protocol</a></span></code></div><div class="spec-doc"><p>Get the version used for the connection. As per the <a href="https://www.openssl.org/docs/man1.1.1/man3/SSL_get_version.html">OpenSSL documentation</a>, should only be called after the initial handshake has been completed. Prior to that the results returned from these functions may be unreliable.</p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <span class="value">Failure</span> <p>if the version is unknown</p></li></ul></div></div><h3 id="certificates"><a href="#certificates" class="anchor"></a>Certificates</h3><div class="odoc-spec"><div class="spec type anchored" id="type-certificate"><a href="#type-certificate" class="anchor"></a><code><span><span class="keyword">type</span> certificate</span></code></div><div class="spec-doc"><p>A certificate.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-read_certificate"><a href="#val-read_certificate" class="anchor"></a><code><span><span class="keyword">val</span> read_certificate : <span>string <span class="arrow">&#45;&gt;</span></span> <a href="#type-certificate">certificate</a></span></code></div><div class="spec-doc"><p><code>read_certificate fname</code> reads the certificate in the file <code>fname</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-write_certificate"><a href="#val-write_certificate" class="anchor"></a><code><span><span class="keyword">val</span> write_certificate : <span>string <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-certificate">certificate</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_certificate"><a href="#val-get_certificate" class="anchor"></a><code><span><span class="keyword">val</span> get_certificate : <span><a href="#type-socket">socket</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-certificate">certificate</a></span></code></div><div class="spec-doc"><p>Get the certificate used by a socket.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_issuer"><a href="#val-get_issuer" class="anchor"></a><code><span><span class="keyword">val</span> get_issuer : <span><a href="#type-certificate">certificate</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Get the issuer of a certificate.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_subject"><a href="#val-get_subject" class="anchor"></a><code><span><span class="keyword">val</span> get_subject : <span><a href="#type-certificate">certificate</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Get the subject of a certificate.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_start_date"><a href="#val-get_start_date" class="anchor"></a><code><span><span class="keyword">val</span> get_start_date : <span><a href="#type-certificate">certificate</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Unix</span>.tm</span></code></div><div class="spec-doc"><p>Get the start date of a certificate.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_expiration_date"><a href="#val-get_expiration_date" class="anchor"></a><code><span><span class="keyword">val</span> get_expiration_date : <span><a href="#type-certificate">certificate</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Unix</span>.tm</span></code></div><div class="spec-doc"><p>Get the expiration date of a certificate.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-load_verify_locations"><a href="#val-load_verify_locations" class="anchor"></a><code><span><span class="keyword">val</span> load_verify_locations : <span><a href="#type-context">context</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>load_verify_locations ctxt cafile capath</code> specifies the locations for the context <code>ctx</code>, at which CA certificates for verification purposes are located. <code>cafile</code> should be the name of a CA certificates file in PEM format and <code>capath</code> should be the name of a directory which contains CA certificates in PEM format. Empty strings can be used in order not to specify on of the parameters (but not both).</p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <span class="value">Invalid_argument</span> <p>if both strings are empty or if one of the files given in arguments could not be found.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-set_default_verify_paths"><a href="#val-set_default_verify_paths" class="anchor"></a><code><span><span class="keyword">val</span> set_default_verify_paths : <span><a href="#type-context">context</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p>Specifies that the default locations from which CA certificates are loaded should be used. Returns <code>true</code> on success.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_verify_result"><a href="#val-get_verify_result" class="anchor"></a><code><span><span class="keyword">val</span> get_verify_result : <span><a href="#type-socket">socket</a> <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p>Get the verification result.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_verify_error_string"><a href="#val-get_verify_error_string" class="anchor"></a><code><span><span class="keyword">val</span> get_verify_error_string : <span>int <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Get a human readable verification error message for the verification error Its input should be the result of calling <code>get_verify_result</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-digest"><a href="#val-digest" class="anchor"></a><code><span><span class="keyword">val</span> digest : <span><span>[ `SHA1 <span>| `SHA256</span> <span>| `SHA384</span> ]</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-certificate">certificate</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Get the digest of the certificate as a binary string, using the SHA1, SHA256 or SHA384 hashing algorithm.</p></div></div><h3 id="creating,-connecting,-closing-and-configuring-sockets"><a href="#creating,-connecting,-closing-and-configuring-sockets" class="anchor"></a>Creating, connecting, closing and configuring sockets</h3><div class="odoc-spec"><div class="spec value anchored" id="val-embed_socket"><a href="#val-embed_socket" class="anchor"></a><code><span><span class="keyword">val</span> embed_socket : <span><span class="xref-unresolved">Unix</span>.file_descr <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-context">context</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-socket">socket</a></span></code></div><div class="spec-doc"><p>Embed a Unix socket into an SSL socket.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-set_client_SNI_hostname"><a href="#val-set_client_SNI_hostname" class="anchor"></a><code><span><span class="keyword">val</span> set_client_SNI_hostname : <span><a href="#type-socket">socket</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Set the hostname the client is attempting to connect to using the Server * Name Indication (SNI) TLS extension.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-set_alpn_protos"><a href="#val-set_alpn_protos" class="anchor"></a><code><span><span class="keyword">val</span> set_alpn_protos : <span><a href="#type-socket">socket</a> <span class="arrow">&#45;&gt;</span></span> <span><span>string list</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Set the list of supported ALPN protocols for negotiation to the connection.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_negotiated_alpn_protocol"><a href="#val-get_negotiated_alpn_protocol" class="anchor"></a><code><span><span class="keyword">val</span> get_negotiated_alpn_protocol : <span><a href="#type-socket">socket</a> <span class="arrow">&#45;&gt;</span></span> <span>string option</span></span></code></div><div class="spec-doc"><p>Get the negotiated protocol from the connection.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-verify"><a href="#val-verify" class="anchor"></a><code><span><span class="keyword">val</span> verify : <span><a href="#type-socket">socket</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Check the result of the verification of the X509 certificate presented by the peer, if any. Raises a <code>verify_error</code> on failure.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-x509_check_flag"><a href="#type-x509_check_flag" class="anchor"></a><code><span><span class="keyword">type</span> x509_check_flag</span><span> = </span></code><ol><li id="type-x509_check_flag.Always_check_subject" class="def variant constructor anchored"><a href="#type-x509_check_flag.Always_check_subject" class="anchor"></a><code><span>| </span><span><span class="constructor">Always_check_subject</span></span></code></li><li id="type-x509_check_flag.No_wildcards" class="def variant constructor anchored"><a href="#type-x509_check_flag.No_wildcards" class="anchor"></a><code><span>| </span><span><span class="constructor">No_wildcards</span></span></code></li><li id="type-x509_check_flag.No_partial_wildcards" class="def variant constructor anchored"><a href="#type-x509_check_flag.No_partial_wildcards" class="anchor"></a><code><span>| </span><span><span class="constructor">No_partial_wildcards</span></span></code></li><li id="type-x509_check_flag.Multi_label_wildcards" class="def variant constructor anchored"><a href="#type-x509_check_flag.Multi_label_wildcards" class="anchor"></a><code><span>| </span><span><span class="constructor">Multi_label_wildcards</span></span></code></li><li id="type-x509_check_flag.Single_label_subdomains" class="def variant constructor anchored"><a href="#type-x509_check_flag.Single_label_subdomains" class="anchor"></a><code><span>| </span><span><span class="constructor">Single_label_subdomains</span></span></code></li></ol></div><div class="spec-doc"><p>Flags to specify how a certificate is matched against a given host name</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-set_hostflags"><a href="#val-set_hostflags" class="anchor"></a><code><span><span class="keyword">val</span> set_hostflags : <span><a href="#type-socket">socket</a> <span class="arrow">&#45;&gt;</span></span> <span><span><a href="#type-x509_check_flag">x509_check_flag</a> list</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-set_host"><a href="#val-set_host" class="anchor"></a><code><span><span class="keyword">val</span> set_host : <span><a href="#type-socket">socket</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-set_ip"><a href="#val-set_ip" class="anchor"></a><code><span><span class="keyword">val</span> set_ip : <span><a href="#type-socket">socket</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Set the expected ip address to be verified. Ip address is dotted decimal quad for IPv4 and colon-separated hexadecimal for IPv6. The condensed &quot;::&quot; notation is supported for IPv6 addresses.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-file_descr_of_socket"><a href="#val-file_descr_of_socket" class="anchor"></a><code><span><span class="keyword">val</span> file_descr_of_socket : <span><a href="#type-socket">socket</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Unix</span>.file_descr</span></code></div><div class="spec-doc"><p>Get the file descriptor associated with a socket. It is primarily useful for <code>select</code>ing on it; you should not write or read on it.</p></div></div><h3 id="i/o-on-ssl-sockets"><a href="#i/o-on-ssl-sockets" class="anchor"></a>I/O on SSL sockets</h3><p>The main SSL communication functions that can block if sockets are in blocking mode. This set of functions releases the OCaml runtime lock, which can require extra copying of application data. The module <code>Runtime_lock</code> provided below lifts this limitation by never releasing the OCaml runtime lock.</p><div class="odoc-spec"><div class="spec value anchored" id="val-connect"><a href="#val-connect" class="anchor"></a><code><span><span class="keyword">val</span> connect : <span><a href="#type-socket">socket</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Connect an SSL socket.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-accept"><a href="#val-accept" class="anchor"></a><code><span><span class="keyword">val</span> accept : <span><a href="#type-socket">socket</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Accept an SSL connection.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-open_connection"><a href="#val-open_connection" class="anchor"></a><code><span><span class="keyword">val</span> open_connection : <span><a href="#type-protocol">protocol</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Unix</span>.sockaddr <span class="arrow">&#45;&gt;</span></span> <a href="#type-socket">socket</a></span></code></div><div class="spec-doc"><p>Open an SSL connection.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-open_connection_with_context"><a href="#val-open_connection_with_context" class="anchor"></a><code><span><span class="keyword">val</span> open_connection_with_context : <span><a href="#type-context">context</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Unix</span>.sockaddr <span class="arrow">&#45;&gt;</span></span> <a href="#type-socket">socket</a></span></code></div><div class="spec-doc"><p>Open an SSL connection with the specified context.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-close_notify"><a href="#val-close_notify" class="anchor"></a><code><span><span class="keyword">val</span> close_notify : <span><a href="#type-socket">socket</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p>Send close notify to the peer. This is SSL_shutdown(3). * returns <code>true</code> if shutdown is finished, <code>false</code> in case <code>close_notify</code> * needs to be called a second time.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-shutdown_connection"><a href="#val-shutdown_connection" class="anchor"></a><code><span><span class="keyword">val</span> shutdown_connection : <span><a href="#type-socket">socket</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Close an SSL connection opened with <code>open_connection</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-shutdown"><a href="#val-shutdown" class="anchor"></a><code><span><span class="keyword">val</span> shutdown : <span><a href="#type-socket">socket</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Close a SSL connection. * Send close notify to the peer and wait for close notify from peer.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-flush"><a href="#val-flush" class="anchor"></a><code><span><span class="keyword">val</span> flush : <span><a href="#type-socket">socket</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Flush an SSL connection.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-read"><a href="#val-read" class="anchor"></a><code><span><span class="keyword">val</span> read : <span><a href="#type-socket">socket</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Stdlib</span>.Bytes.t <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p><code>read sock buf off len</code> receives data from a connected SSL socket.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-read_into_bigarray"><a href="#val-read_into_bigarray" class="anchor"></a><code><span><span class="keyword">val</span> read_into_bigarray : <span><a href="#type-socket">socket</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-bigarray">bigarray</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p><code>read_into_bigarray sock ba off len</code> receives data from a connected SSL socket. This function releases the runtime while the read takes place.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-write"><a href="#val-write" class="anchor"></a><code><span><span class="keyword">val</span> write : <span><a href="#type-socket">socket</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Stdlib</span>.Bytes.t <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p><code>write sock buf off len</code> sends data over a connected SSL socket.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-write_substring"><a href="#val-write_substring" class="anchor"></a><code><span><span class="keyword">val</span> write_substring : <span><a href="#type-socket">socket</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p><code>write_substring sock str off len</code> sends data over a connected SSL socket.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-write_bigarray"><a href="#val-write_bigarray" class="anchor"></a><code><span><span class="keyword">val</span> write_bigarray : <span><a href="#type-socket">socket</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-bigarray">bigarray</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p><code>write_bigarray sock ba off len</code> sends data over a connected SSL socket. This function releases the runtime while the read takes place.</p></div></div><h4 id="high-level-communication-functions"><a href="#high-level-communication-functions" class="anchor"></a>High-level communication functions</h4><div class="odoc-spec"><div class="spec value anchored" id="val-input_string"><a href="#val-input_string" class="anchor"></a><code><span><span class="keyword">val</span> input_string : <span><a href="#type-socket">socket</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Input a string on an SSL socket.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-output_string"><a href="#val-output_string" class="anchor"></a><code><span><span class="keyword">val</span> output_string : <span><a href="#type-socket">socket</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Write a string on an SSL socket.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-input_char"><a href="#val-input_char" class="anchor"></a><code><span><span class="keyword">val</span> input_char : <span><a href="#type-socket">socket</a> <span class="arrow">&#45;&gt;</span></span> char</span></code></div><div class="spec-doc"><p>Input a character on an SSL socket.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-output_char"><a href="#val-output_char" class="anchor"></a><code><span><span class="keyword">val</span> output_char : <span><a href="#type-socket">socket</a> <span class="arrow">&#45;&gt;</span></span> <span>char <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Write a char on an SSL socket.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-input_int"><a href="#val-input_int" class="anchor"></a><code><span><span class="keyword">val</span> input_int : <span><a href="#type-socket">socket</a> <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p>Input an integer on an SSL socket.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-output_int"><a href="#val-output_int" class="anchor"></a><code><span><span class="keyword">val</span> output_int : <span><a href="#type-socket">socket</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Write an integer on an SSL socket.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Runtime_lock"><a href="#module-Runtime_lock" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Runtime_lock/index.html">Runtime_lock</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p><code>Runtime_lock</code> is an equivalent, signature compatible, equivalent to the <code>Ssl</code> module, with one difference: the OCaml runtime lock isn't released before calling the underlying SSL primitives. Multiple systhreads cannot, therefore, run concurrently.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-read_into_bigarray_blocking"><a href="#val-read_into_bigarray_blocking" class="anchor"></a><code><span><span class="keyword">val</span> read_into_bigarray_blocking : <span><a href="#type-socket">socket</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-bigarray">bigarray</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p>This function is deprecated. Use <code>Runtime_lock.read_into_bigarray</code> instead.</p><ul class="at-tags"><li class="deprecated"><span class="at-tag">deprecated</span> Use [Runtime_lock.read_into_bigarray] instead</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-write_bigarray_blocking"><a href="#val-write_bigarray_blocking" class="anchor"></a><code><span><span class="keyword">val</span> write_bigarray_blocking : <span><a href="#type-socket">socket</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-bigarray">bigarray</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p>This function is deprecated. Use <code>Runtime_lock.write_bigarray</code> instead.</p><ul class="at-tags"><li class="deprecated"><span class="at-tag">deprecated</span> Use [Runtime_lock.write_bigarray] instead</li></ul></div></div></div></body></html>